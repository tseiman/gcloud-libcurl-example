<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="611px" preserveAspectRatio="none" style="width:630px;height:611px;" version="1.1" viewBox="0 0 630 611" width="630px" zoomAndPan="magnify"><defs><filter height="300%" id="f1qdyg5fpcmfql" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="51" x2="51" y1="87.1358" y2="516.4321"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="173" x2="173" y1="87.1358" y2="516.4321"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="319" x2="319" y1="87.1358" y2="516.4321"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="405" x2="405" y1="87.1358" y2="516.4321"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="488" x2="488" y1="87.1358" y2="516.4321"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="589" x2="589" y1="87.1358" y2="516.4321"/><rect fill="#FEFECE" filter="url(#f1qdyg5fpcmfql)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="83" x="8" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="15" y="51.9659">IoT Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="35" y="71.0339">APIs</text><rect fill="#FEFECE" filter="url(#f1qdyg5fpcmfql)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="83" x="8" y="515.4321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="15" y="537.398">IoT Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="29" x="35" y="556.466">APIs</text><rect fill="#ADD8E6" filter="url(#f1qdyg5fpcmfql)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="83" x="130" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="137" y="51.9659">IoT Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="158" y="71.0339">App</text><rect fill="#ADD8E6" filter="url(#f1qdyg5fpcmfql)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="83" x="130" y="515.4321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="69" x="137" y="537.398">IoT Device</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="158" y="556.466">App</text><rect fill="#FEFECE" filter="url(#f1qdyg5fpcmfql)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="279" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="286" y="51.9659">GCP Auth</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="296" y="71.0339">Server</text><rect fill="#FEFECE" filter="url(#f1qdyg5fpcmfql)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="77" x="279" y="515.4321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="286" y="537.398">GCP Auth</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="43" x="296" y="556.466">Server</text><rect fill="#FEFECE" filter="url(#f1qdyg5fpcmfql)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="370" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="377" y="51.9659">GCP API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="379" y="71.0339">servers</text><rect fill="#FEFECE" filter="url(#f1qdyg5fpcmfql)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="67" x="370" y="515.4321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="377" y="537.398">GCP API</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="49" x="379" y="556.466">servers</text><rect fill="#FEFECE" filter="url(#f1qdyg5fpcmfql)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="451" y="30"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="473" y="51.9659">GCP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="458" y="71.0339">Pub/Sub</text><rect fill="#FEFECE" filter="url(#f1qdyg5fpcmfql)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="71" x="451" y="515.4321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="473" y="537.398">GCP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="57" x="458" y="556.466">Pub/Sub</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="573" y="63.9659">GCP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="555" y="83.0339">BigQuery</text><path d="M571.5,13 C571.5,3 589.5,3 589.5,3 C589.5,3 607.5,3 607.5,13 L607.5,39 C607.5,49 589.5,49 589.5,49 C589.5,49 571.5,49 571.5,39 L571.5,13 " fill="#FEFECE" filter="url(#f1qdyg5fpcmfql)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M571.5,13 C571.5,23 589.5,23 589.5,23 C589.5,23 607.5,23 607.5,13 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="27" x="573" y="530.398">GCP</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="63" x="555" y="549.466">BigQuery</text><path d="M571.5,563.5679 C571.5,553.5679 589.5,553.5679 589.5,553.5679 C589.5,553.5679 607.5,553.5679 607.5,563.5679 L607.5,589.5679 C607.5,599.5679 589.5,599.5679 589.5,599.5679 C589.5,599.5679 571.5,599.5679 571.5,589.5679 L571.5,563.5679 " fill="#FEFECE" filter="url(#f1qdyg5fpcmfql)" style="stroke: #000000; stroke-width: 1.5;"/><path d="M571.5,563.5679 C571.5,573.5679 589.5,573.5679 589.5,573.5679 C589.5,573.5679 607.5,573.5679 607.5,563.5679 " fill="none" style="stroke: #000000; stroke-width: 1.5;"/><polygon fill="#A80036" points="161.5,116.8419,171.5,120.8419,161.5,124.8419,165.5,120.8419" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="3" x2="167.5" y1="120.8419" y2="120.8419"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="117" x="10" y="115.0328">create and sing JWT</text><polygon fill="#A80036" points="307.5,166.2539,317.5,170.2539,307.5,174.2539,311.5,170.2539" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="173.5" x2="313.5" y1="170.2539" y2="170.2539"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="180.5" y="146.7389">use JWT to reques</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="180.5" y="164.4449">tOAuth2 token</text><polygon fill="#A80036" points="184.5,215.6659,174.5,219.6659,184.5,223.6659,180.5,219.6659" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="178.5" x2="318.5" y1="219.6659" y2="219.6659"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="122" x="190.5" y="196.1509">on success response</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="190.5" y="213.8569">with OAuth2 token</text><polygon fill="#A80036" points="62.5,229.6659,52.5,233.6659,62.5,237.6659,58.5,233.6659" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="56.5" x2="172.5" y1="233.6659" y2="233.6659"/><polygon fill="#A80036" points="161.5,279.0779,171.5,283.0779,161.5,287.0779,165.5,283.0779" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="51.5" x2="167.5" y1="283.0779" y2="283.0779"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="58.5" y="259.5629">obtain KPIs</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="58.5" y="277.2689">from system API</text><polygon fill="#A80036" points="393.5,346.196,403.5,350.196,393.5,354.196,397.5,350.196" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="173.5" x2="399.5" y1="350.196" y2="350.196"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="180.5" y="308.975">use OAuth2 token</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="180.5" y="326.681">to call GCP API (pub/sub),</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="156" x="180.5" y="344.387">transfering JSON message</text><polygon fill="#A80036" points="184.5,377.902,174.5,381.902,184.5,385.902,180.5,381.902" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="178.5" x2="404.5" y1="381.902" y2="381.902"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="159" x="190.5" y="376.093">response with MessageIDs</text><polygon fill="#A80036" points="476.5,427.314,486.5,431.314,476.5,435.314,480.5,431.314" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="405.5" x2="482.5" y1="431.314" y2="431.314"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="44" x="412.5" y="407.799">publish</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="53" x="412.5" y="425.505">message</text><polygon fill="#A80036" points="577.5,494.4321,587.5,498.4321,577.5,502.4321,581.5,498.4321" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="488.5" x2="583.5" y1="498.4321" y2="498.4321"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="68" x="495.5" y="457.2111">check JSON</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="495.5" y="474.9171">schema and</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="495.5" y="492.6231">transfer data</text><!--MD5=[ce152ddaf1fb2c4f6e11041a8491cfaa]
@startuml
participant "IoT Device\nAPIs"
participant "IoT Device\nApp" #lightblue
participant "GCP Auth\nServer"
participant "GCP API\nservers"
participant "GCP\nPub/Sub"
database "GCP\nBigQuery"
-> "IoT Device\nApp" : create and sing JWT 
"IoT Device\nApp" -> "GCP Auth\nServer": use JWT to reques\ntOAuth2 token
"IoT Device\nApp" <- - "GCP Auth\nServer": on success response\nwith OAuth2 token
"IoT Device\nAPIs" <- "IoT Device\nApp"
"IoT Device\nAPIs" -> "IoT Device\nApp": obtain KPIs\nfrom system API
"IoT Device\nApp" -> "GCP API\nservers": use OAuth2 token\nto call GCP API (pub/sub),\ntransfering JSON message
"IoT Device\nApp" <- "GCP API\nservers": response with MessageIDs
"GCP API\nservers" ->  "GCP\nPub/Sub": publish\nmessage
"GCP\nPub/Sub" -> "GCP\nBigQuery": check JSON\nschema and\ntransfer data
@enduml

PlantUML version 1.2020.02(Sun Mar 01 11:22:07 CET 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 17.0.9+9-Ubuntu-123.10
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>